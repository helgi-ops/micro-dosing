<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Player</title>
    <link rel="stylesheet" href="./assets/ui.css" />
    <script>
      // Supabase public client config (anon key is safe to expose)
      window.__SUPABASE_URL__ = "https://tbtkxttiwbdmugjivmvb.supabase.co";
      window.__SUPABASE_ANON_KEY__ = "sb_publishable_7ePvUt_6A7KKyGpV7eYfaQ_3w81AUuA";
    </script>
    <style>
      .wrap { max-width: 980px; margin: 0 auto; padding: 18px; }
      .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
      .card { background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.08); border-radius: 14px; padding: 14px; }
      .muted { opacity: .75; }
      .kvs { display:grid; grid-template-columns: 160px 1fr; gap: 6px 10px; }
      .actions { display:flex; gap:10px; flex-wrap:wrap; }
      button { cursor:pointer; }
      .danger { border-color: rgba(255,80,80,.45); }
      .list { margin: 0; padding-left: 18px; }
      .pill { display:inline-block; padding: 4px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,.15); }
      .spacer { height: 10px; }
      a { color: inherit; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="row" style="justify-content:space-between;">
        <div class="row">
          <a href="./coach.html" class="muted">← Back</a>
          <span class="muted">/</span>
          <strong id="crumbName">Player</strong>
        </div>
        <span id="status" class="muted">Loading…</span>
      </div>

      <div class="spacer"></div>

      <h1 id="playerName">Player</h1>

      <div class="card" id="playerCard">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div style="font-size:22px; font-weight:700;" id="playerNameCard">—</div>
          </div>
        </div>
      </div>

      <div class="spacer"></div>

      <div class="card">
        <div class="row" style="justify-content:space-between;">
          <strong>Assigned week preview</strong>
          <span class="muted" id="weeksCount">—</span>
        </div>
        <div class="spacer"></div>
        <ul class="list" id="weeksList"></ul>
        <div class="muted" id="weeksEmpty" style="display:none;">No assigned week found.</div>
      </div>

      <div class="spacer"></div>

      <section id="weekPreview">
        <h2>Vikan þín</h2>
        <div id="weekBox"></div>
      </section>

      <div class="spacer"></div>

      <div class="card" id="readinessCard">
        <div class="row" style="justify-content:space-between;">
          <strong>Readiness (today)</strong>
          <span class="muted" id="checkinStatus">Not submitted</span>
        </div>
        <div class="spacer"></div>
        <div class="readiness-body">
          <div class="readiness-summary muted">Answer honestly — this adjusts today’s training load.</div>
          <div class="readiness-tiles">
            <div class="tile">
              <h4>Readiness</h4>
              <div class="sub">How ready you feel right now (1–10)</div>
              <select id="readinessInput" class="tile-select">
                <option value="" disabled selected>Select readiness…</option>
                <option value="1">1 — Very low energy / heavy fatigue</option>
                <option value="2">2 — Very low energy / heavy fatigue</option>
                <option value="3">3 — Very low energy / heavy fatigue</option>
                <option value="4">4 — OK / not at your best</option>
                <option value="5">5 — OK / not at your best</option>
                <option value="6">6 — OK / not at your best</option>
                <option value="7">7 — Good / ready to train</option>
                <option value="8">8 — Good / ready to train</option>
                <option value="9">9 — Excellent / fully primed</option>
                <option value="10">10 — Excellent / fully primed</option>
              </select>
            </div>
            <div class="tile">
              <h4>Soreness</h4>
              <div class="sub">Muscle soreness today (1–5)</div>
              <select id="sorenessInput" class="tile-select">
                <option value="" disabled selected>Select soreness…</option>
                <option value="1">1 — No soreness</option>
                <option value="2">2 — Mild soreness (no limitation)</option>
                <option value="3">3 — Noticeable soreness (manageable)</option>
                <option value="4">4 — High soreness (affects movement)</option>
                <option value="5">5 — Very sore or painful</option>
              </select>
            </div>
            <div class="tile">
              <h4>Sleep</h4>
              <div class="sub">Last night (0–2)</div>
              <div class="seg" id="sleepSeg">
                <button type="button" data-sleep="0">0 Poor</button>
                <button type="button" data-sleep="1">1 OK</button>
                <button type="button" data-sleep="2">2 Good</button>
              </div>
              <input id="sleepInput" type="hidden" value="" />
            </div>
          </div>
          <div class="actions-row">
            <button id="saveCheckinBtn">Save check-in</button>
            <span class="muted" id="checkinStatusInline"></span>
          </div>
        </div>
      </div>

      <div class="spacer"></div>

      <div class="card" id="cmjCard">
        <div class="row" style="justify-content:space-between;">
          <strong>CMJ test</strong>
          <span class="muted" id="cmjStatus">No test today</span>
        </div>
        <div class="spacer"></div>
        <div class="row">
          <label>CMJ value (cm)<br/><input id="cmjInput" type="number" min="0" step="0.1" /></label>
          <div class="muted">
            <div>All-time best: <span id="cmjBest">—</span></div>
            <div>Most recent: <span id="cmjRecent">—</span></div>
            <div>% of best: <span id="cmjPct">—</span></div>
          </div>
        </div>
        <div class="spacer"></div>
        <button id="saveCmjBtn">Save CMJ</button>
      </div>

      <div class="spacer"></div>

      <div class="card" id="assignCard">
        <div class="row" style="justify-content:space-between;">
          <strong>Today’s workout</strong>
          <button id="assignWorkoutBtn">Assign workout</button>
        </div>
        <div class="spacer"></div>
        <div id="workoutArea" class="muted">No workout assigned yet.</div>
      </div>
    </div>

    <script type="module">
      import { requirePlayerAuth } from "./assets/player-auth-guard.js";
      await requirePlayerAuth();
    </script>
    <script type="module" src="./assets/player-token.js"></script>
  </body>
</html>
